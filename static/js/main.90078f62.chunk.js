(this["webpackJsonpxstate-react-typescript-template"]=this["webpackJsonpxstate-react-typescript-template"]||[]).push([[0],{22:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return parse}));var _srgs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(9);function LOG(t){}function clone(t){if(null==t||"object"!=typeof t)return t;var e=new t.constructor;for(var n in t)e[n]=clone(t[n]);return e}function isEmpty(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}function Chart(t){this.numberOfWords=t,this.passives=new Array(t),this.actives=new Array(t);for(var e=0;e<=t;e++)this.passives[e]={},this.actives[e]={};this.add=function(t){var e,n;return t.isPassive?(e=this.passives[t.start],n=t.lhs):(e=this.actives[t.end],n=t.next.content),n in e||(e[n]={}),!(t in e[n])&&(e[n][t]=t,!0)},this.resultsForRule=function(e,n,r){n=n||0,r=r||t;var s=[],a=this.passives[n][e];for(var o in a)a[o].end==r&&s.push(a[o].out);return s},this.allEdges=function(){return this.allPassiveEdges().concat(this.allActiveEdges())},this.allPassiveEdges=function(){var t=[];for(var e in this.passives)for(var n in this.passives[e])for(var r in this.passives[e][n])t.push(this.passives[e][n][r]);return t},this.allActiveEdges=function(){var t=[];for(var e in this.actives)for(var n in this.actives[e])for(var r in this.actives[e][n])t.push(this.actives[e][n][r]);return t},this.statistics=function(){var t=this.allPassiveEdges().length,e=this.allActiveEdges().length;return{nrEdges:t+e,nrPassiveEdges:t,nrActiveEdges:e}}}function PassiveEdge(t,e,n,r){this.start=t,this.end=e,this.lhs=n,this.out=r,this.isPassive=!0;var s="["+t+"-"+e+"] $"+n+" := "+r;this._string=s,this.toString=function(){return this._string}}function ActiveEdge(t,e,n,r,s,a,o,i){this.start=t,this.end=e,this.lhs=n,this.next=r,this.rest=s,this.out=a,this.rules=o,this.text=i,this.isPassive=!1;var c="<"+t+"-"+e+"> $"+n+" -> "+r+", "+s+" := "+a+" <- "+o;this._string=c,this.toString=function(){return this._string}}function parse(words,grammar,root,filter){root||(root=grammar.$root);var chart=new Chart(words.length),agenda=[],leftCornerFilter;function addToChart(inference,start,end,lhs,rhs,out,rules,text){var edge;if(rhs.length>0){var next=rhs[0],rest=rhs.slice(1);switch(next.constructor){case Array:return void addToChart(inference+",SEQUENCE",start,end,lhs,next.concat(rest),out,rules,text);case _srgs__WEBPACK_IMPORTED_MODULE_0__.g:var min=next.min,max=next.max;if(min<=0&&addToChart(inference+",SKIP",start,end,lhs,rest,out,rules,text),max>0){var content=next.content,rhs=1==max?[content]:[content,_srgs__WEBPACK_IMPORTED_MODULE_0__.f(min?min-1:min,max-1,content)];addToChart(inference+",REPEAT",start,end,lhs,rhs.concat(rest),out,rules,text)}return;case _srgs__WEBPACK_IMPORTED_MODULE_0__.c:var oneof=next.content;for(var i in oneof){var rhs=oneof[i].concat(rest);addToChart(inference+",ONEOF",start,end,lhs,rhs,out,rules,text)}return;case _srgs__WEBPACK_IMPORTED_MODULE_0__.i:return out=clone(out),rules=clone(rules),eval(next.content),void addToChart(inference+",TAG",start,end,lhs,rest,out,rules,text)}edge=new ActiveEdge(start,end,lhs,next,rest,out,rules,text)}else edge=new PassiveEdge(start,end,lhs,out);chart.add(edge)&&(LOG("+ "+inference+": "+edge),agenda.push(edge))}for(leftCornerFilter=void 0==filter?function(){return!0}:function(t,e){var n=filter[t];return!n||words[e]in n},addToChart("INIT",0,0,root,grammar[root],{},{},{});agenda.length>0;){var edge=agenda.pop(),start=edge.start,end=edge.end,lhs=edge.lhs,next=edge.next;if(LOG(edge),edge.isPassive){var actives=chart.actives[start][lhs];for(var i in actives){var active=actives[i],rules=clone(active.rules),text=active.text;text[edge.lhs]=words.slice(start,end).join(" "),"object"==typeof edge.out&&isEmpty(edge.out)?rules[edge.lhs]=text[edge.lhs]:rules[edge.lhs]=clone(edge.out),addToChart("COMBINE",active.start,end,active.lhs,active.rest,active.out,rules,text)}}else if(next.constructor==_srgs__WEBPACK_IMPORTED_MODULE_0__.e){var ref=next.content,passives=chart.passives[end][ref];for(var i in passives){var passive=passives[i],rules=clone(edge.rules),text=edge.text;rules[passive.lhs]=clone(passive.out),text[passive.lhs]=passive.text,addToChart("COMBINE",start,passive.end,lhs,edge.rest,edge.out,rules,text)}ref in grammar&&leftCornerFilter(ref,end)&&addToChart("PREDICT",end,end,ref,grammar[ref],{},{},{})}else next==words[end]&&addToChart("SCAN",start,end+1,lhs,edge.rest,edge.out,edge.rules,edge.text)}return chart}},31:function(t,e,n){},42:function(t,e,n){"use strict";n.r(e),n.d(e,"nluRequest",(function(){return N}));var r=n(28),s=n(11),a=(n(31),n(7),n(25)),o=n(21),i=n(2),c=n(46),u=n(45),l=n(12),d=n(9);function h(t){for(var e=function(t){if("undefined"!=typeof DOMParser)return(new DOMParser).parseFromString(t,"application/xml");if("undefined"!=typeof ActiveXObject){var e=XML.newDocument();return e.loadXML(t),e}var n="data:text/xml;charset=utf-8,"+encodeURIComponent(t),r=new XMLHttpRequest;return r.open("GET",n,!1),r.send(null),r.responseXML}(t),n=e.getElementsByTagName("grammar")[0].getAttribute("root"),r=new d.a(n),s=e.getElementsByTagName("rule"),a=0;a<s.length;a++){var o=s[a];r[o.getAttribute("id")]=m(o)}return r}function m(t){for(var e=t.childNodes,n=[],r=0;r<e.length;r++)if(3==e[r].nodeType){var s=e[r].textContent.trim();""!=s&&n.push(s.split(/ +/))}else if(1==e[r].nodeType)if("token"==e[r].nodeName)n.push(d.h(e[r].textContent));else if("ruleref"==e[r].nodeName){var a=e[r].getAttribute("uri");n.push(d.d(a.slice(1)))}else if("tag"==e[r].nodeName)n.push(d.h(e[r].textContent.trim()));else if("one-of"==e[r].nodeName)n.push(d.b(m(e[r])));else if("item"==e[r].nodeName){var o=e[r].getAttribute("repeat");if(o){var i=o.split("-"),c=parseInt(i[0]),u=parseInt(i[1]);u=u||1/0,n.push(d.f(c,u,m(e[r])))}else n.push(m(e[r]))}else console.log(e[r]);return n}var p=n(22);const g='\n<grammar root="home">\n\n<rule id="home">\n\n<item repeat="0-1">with</item>\n\n<item repeat="0-1"><ruleref uri="#person"/>\n<tag>out.person=rules.person;</tag></item>\n\n<item repeat="0-1">on</item>\n\n<item repeat="0-1"><ruleref uri="#day"/>\n<tag>out.day=rules.day;</tag></item>\n\n<item repeat="0-1">at</item>\n\n<item repeat="0-1"><ruleref uri="#time"/>\n<tag>out.time=rules.time;</tag></item>\n\n<item repeat="0-1">o\'clock</item>\n\n <rule id="person"> \n<one-of> \n<item> Monica <tag> out = \'Monica Geller\'; \n</tag></item> \n<item> Rachel <tag> out = \'Rachel Green\'; \n</tag></item>\n<item> Joey <tag> out = \'Joey Tribbiani\'; \n</tag></item> \n<item> Phoebe <tag> out = \'Phoebe Buffay\'; \n</tag></item> \n<item> Ross <tag> out = \'Ross Geller\'; \n</tag></item> \n<item> Chandler <tag> out = \'Chandler Bing\'; \n</tag></item> \n </one-of> \n </rule>\n\n <rule id="day"> \n<one-of> \n<item> Monday </item> \n<item> Tuesday </item>\n<item> Wednesday </item> \n<item> Thursday </item> \n<item> Friday </item> \n<item> Saturday </item> \n<item> Sunday </item> \n </one-of> \n </rule>\n\n <rule id="time"> \n<one-of> \n<item> 10 <tag> out = \'10:00\'; \n</tag></item> \n<item> 11 <tag> out = \'11:00\'; \n</tag></item>\n<item> 12 <tag> out = \'12:00\'; \n</tag></item> \n<item> 1 <tag> out = \'13:00\'; \n</tag></item> \n<item> 2 <tag> out = \'14:00\'; \n</tag></item> \n<item> 3 <tag> out = \'15:00\'; \n</tag></item> \n<item> 4 <tag> out = \'16:00\'; \n</tag></item>\n<item> all day </item> \n </one-of> \n </rule>\n\n </grammar>\n',E=t=>{const e=h(g),n=Object(p.a)(t.split(/\s+/),e).resultsForRule(e.$root)[0];return n.action1?[n.action1,n.object1]:[n.action2,n.object2]},y=t=>{const e=h(g);return Object(p.a)(t.split(/\s+/),e).resultsForRule(e.$root)[0]};function f(t){return v((e=>({type:"SPEAK",value:t})))}const v=l.a.send,x=l.a.cancel,R={yes:{yes:!0},"of course":{yes:!0},sure:{yes:!0},yeah:{yes:!0},no:{no:!1},"no way":{no:!1},nope:{no:!1}};const _={initial:"init",states:{init:{on:{CLICK:"createAppointment"}},createAppointment:{initial:"who",on:{RECOGNISED:{target:"help",cond:t=>"help"===t.recResult},MAXSPEECH:[{target:"maxspeech2",cond:t=>1===t.counter},{target:"maxspeech3",cond:t=>2===t.counter},{target:"maxspeech1"}]},states:{hist:{type:"history"},who:{initial:"prompt",on:{RECOGNISED:[{target:"#root.dm.help",cond:t=>"help"===t.recResult},{cond:t=>y(t.recResult).person&&!y(t.recResult).day&&!y(t.recResult).time,actions:[Object(i.b)((t=>({person:y(t.recResult).person}))),x("maxsp")],target:"day"},{cond:t=>y(t.recResult).person&&y(t.recResult).day&&!y(t.recResult).time,actions:[Object(i.b)((t=>({day:y(t.recResult).day,person:y(t.recResult).person}))),x("maxsp")],target:"allday"},{cond:t=>y(t.recResult).person&&y(t.recResult).day&&"all day"===y(t.recResult).time,actions:[Object(i.b)((t=>({day:y(t.recResult).day,person:y(t.recResult).person,time:y(t.recResult).time}))),x("maxsp")],target:"schedule_meeting_allday"},{cond:t=>y(t.recResult).person&&y(t.recResult).day&&y(t.recResult).time&&"all day"!==y(t.recResult).time,actions:[Object(i.b)((t=>({day:y(t.recResult).day,person:y(t.recResult).person,time:y(t.recResult).time}))),x("maxsp")],target:"schedule_meeting"},{target:".nomatch"}]},states:{prompt:Object(s.a)({},(b="Let's create an appointment! Who are you meeting with?",{initial:"prompt",states:{prompt:{entry:f(b),on:{ENDSPEECH:"ask"}},ask:{entry:[v("LISTEN"),v("MAXSPEECH",{delay:4e3,id:"maxsp"})]}}})),nomatch:{entry:f("Sorry I don't know them."),on:{ENDSPEECH:[{target:"prompt",actions:x("maxsp")}]}}}},day:{initial:"prompt",on:{RECOGNISED:[{target:"#root.dm.help",cond:t=>"help"===t.recResult},{cond:t=>t.person&&y(t.recResult).day&&!y(t.recResult).time,actions:[Object(i.b)((t=>({day:y(t.recResult).day}))),x("maxsp")],target:"allday"},{cond:t=>t.person&&y(t.recResult).day&&"all day"===y(t.recResult).time,actions:[Object(i.b)((t=>({day:y(t.recResult).day,time:y(t.recResult).time}))),x("maxsp")],target:"schedule_meeting_allday"},{cond:t=>t.person&&y(t.recResult).day&&y(t.recResult).time&&"all day"!==y(t.recResult).time,actions:[Object(i.b)((t=>({day:y(t.recResult).day,time:y(t.recResult).time}))),x("maxsp")],target:"schedule_meeting"},{target:".nomatch"}]},states:{prompt:{entry:v((t=>({type:"SPEAK",value:"OK. ".concat(t.person,". On which day is your meeting?")}))),on:{ENDSPEECH:"ask"}},ask:{entry:[v("LISTEN"),v("MAXSPEECH",{delay:4e3,id:"maxsp"})]},nomatch:{entry:f("Sorry I didn't catch that. On which day is your meeting?"),on:{ENDSPEECH:[{target:"ask",actions:x("maxsp")}]}}}},allday:{initial:"prompt",on:{RECOGNISED:[{target:"#root.dm.help",cond:t=>"help"===t.recResult},{cond:t=>"yes"in(R[t.recResult]||{}),actions:x("maxsp"),target:"schedule_meeting_allday"},{cond:t=>"no"in(R[t.recResult]||{}),actions:x("maxsp"),target:"time"},{target:".nomatch"}]},states:{prompt:{entry:v((t=>({type:"SPEAK",value:"OK. ".concat(t.day,". Will it take all day?")}))),on:{ENDSPEECH:"ask"}},ask:{entry:[v("LISTEN"),v("MAXSPEECH",{delay:4e3,id:"maxsp"})]},nomatch:{entry:f("Sorry I didn't catch that. Will it take all day?"),on:{ENDSPEECH:[{target:"ask",actions:x("maxsp")}]}}}},time:{initial:"prompt",on:{RECOGNISED:[{target:"#root.dm.help",cond:t=>"help"===t.recResult},{cond:t=>y(t.recResult).time,actions:[Object(i.b)((t=>({time:y(t.recResult).time}))),x("maxsp")],target:"schedule_meeting"},{target:".nomatch"}]},states:{prompt:{entry:v((t=>({type:"SPEAK",value:"OK. What time is your meeting?"}))),on:{ENDSPEECH:"ask"}},ask:{entry:[v("LISTEN"),v("MAXSPEECH",{delay:4e3,id:"maxsp"})]},nomatch:{entry:f("Sorry I didn't catch that. What time is your meeting?"),on:{ENDSPEECH:[{target:"ask",actions:x("maxsp")}]}}}},schedule_meeting_allday:{initial:"prompt",on:{RECOGNISED:[{target:"#root.dm.help",cond:t=>"help"===t.recResult},{cond:t=>"yes"in(R[t.recResult]||{}),actions:x("maxsp"),target:"end"},{cond:t=>"no"in(R[t.recResult]||{}),actions:x("maxsp"),target:"who"},{target:".nomatch"}]},states:{prompt:{entry:v((t=>({type:"SPEAK",value:"Do you want me to create an appointment with ".concat(t.person," on ").concat(t.day,"?")}))),on:{ENDSPEECH:"ask"}},ask:{entry:[v("LISTEN"),v("MAXSPEECH",{delay:4e3,id:"maxsp"})]},nomatch:{entry:f("Sorry I didn't catch that"),on:{ENDSPEECH:[{target:"ask",actions:x("maxsp")}]}}}},schedule_meeting:{initial:"prompt",on:{RECOGNISED:[{target:"#root.dm.help",cond:t=>"help"===t.recResult},{cond:t=>"yes"in(R[t.recResult]||{}),actions:x("maxsp"),target:"end"},{cond:t=>"no"in(R[t.recResult]||{}),actions:x("maxsp"),target:"who"},{target:".nomatch"}]},states:{prompt:{entry:v((t=>({type:"SPEAK",value:"Do you want me to create an appointment with ".concat(t.person," on ").concat(t.day," at ").concat(t.time,"?")}))),on:{ENDSPEECH:"ask"}},ask:{entry:[v("LISTEN"),v("MAXSPEECH",{delay:4e3,id:"maxsp"})]},nomatch:{entry:f("Sorry I didn't catch that"),on:{ENDSPEECH:[{target:"ask",actions:x("maxsp")}]}}}},end:{initial:"prompt",states:{prompt:{entry:f("Your appointment has been created."),on:{ENDSPEECH:"#root.dm"}}}}}},maxspeech1:{entry:f("I couldn't hear you."),on:{ENDSPEECH:[{target:"#root.dm.createAppointment.hist",cond:t=>1===t.counter},{target:"#root.dm.createAppointment.hist",cond:t=>2===t.counter},{target:"#root.dm.createAppointment.hist",cond:t=>3===t.counter}]}},maxspeech2:{entry:f("Are you there?"),on:{ENDSPEECH:[{target:"#root.dm.createAppointment.hist",cond:t=>1===t.counter},{target:"#root.dm.createAppointment.hist",cond:t=>2===t.counter},{target:"#root.dm.createAppointment.hist",cond:t=>3===t.counter}]}},maxspeech3:{entry:f("You're not even listening, I give up."),on:{ENDSPEECH:[{target:"#root.dm.createAppointment.hist",cond:t=>1===t.counter},{target:"#root.dm.createAppointment.hist",cond:t=>2===t.counter},{target:"#root.dm",cond:t=>3===t.counter}]}},help:{initial:"prompt",states:{prompt:{entry:f("Help message."),on:{ENDSPEECH:"#root.dm.createAppointment.hist"}}}}}};var b;Object(i.b)((t=>({action:E(t.recResult)[0]}))),Object(i.b)((t=>({object:E(t.recResult)[1]}))),f("What would you like to do?"),v("LISTEN"),v((t=>({type:"SPEAK",value:"OK. I will ".concat(t.action," the ").concat(t.object,".")})));var S=n(24),O=n(14);Object(u.a)({url:"https://statecharts.io/inspect",iframe:!1});const C=Object(o.a)({id:"root",type:"parallel",states:{dm:Object(s.a)({},_),asrtts:{initial:"idle",states:{idle:{on:{LISTEN:"recognising",SPEAK:{target:"speaking",actions:Object(i.b)(((t,e)=>({ttsAgenda:e.value})))}}},recognising:{initial:"progress",entry:"recStart",exit:"recStop",on:{ASRRESULT:{actions:["recLogResult",Object(i.b)(((t,e)=>({recResult:e.value})))],target:".match"},RECOGNISED:"idle",MAXSPEECH:{actions:Object(i.b)((t=>t.counter?{counter:t.counter+1}:{counter:1})),target:"idle"}},states:{progress:{},match:{entry:Object(i.q)("RECOGNISED")}}},speaking:{entry:"ttsStart",on:{ENDSPEECH:"idle"}}}}}},{actions:{recLogResult:t=>{console.log("<< ASR: "+t.recResult)},test:()=>{console.log("test")},logIntent:t=>{console.log("<< NLU intent: "+t.nluData.intent.name)}}}),P=t=>{switch(!0){case t.state.matches({asrtts:"recognising"}):return Object(O.jsx)("button",Object(s.a)(Object(s.a)({type:"button",className:"glow-on-hover",style:{animation:"glowing 20s linear"}},t),{},{children:"Listening..."}));case t.state.matches({asrtts:"speaking"}):return Object(O.jsx)("button",Object(s.a)(Object(s.a)({type:"button",className:"glow-on-hover",style:{animation:"bordering 1s infinite"}},t),{},{children:"Speaking..."}));default:return Object(O.jsx)("button",Object(s.a)(Object(s.a)({type:"button",className:"glow-on-hover"},t),{},{children:"Click to start"}))}};function A(){const t=Object(S.useSpeechSynthesis)({onEnd:()=>{d("ENDSPEECH")}}),e=t.speak,n=t.cancel,s=(t.speaking,Object(S.useSpeechRecognition)({onResult:t=>{d({type:"ASRRESULT",value:t})}})),a=s.listen,o=(s.listening,s.stop),i=Object(c.b)(C,{devTools:!0,actions:{recStart:Object(c.a)((()=>{console.log("Ready to receive a command."),a({interimResults:!1,continuous:!0})})),recStop:Object(c.a)((()=>{console.log("Recognition stopped."),o()})),changeColour:Object(c.a)((t=>{console.log("Repainting..."),document.body.style.background=t.recResult})),ttsStart:Object(c.a)(((t,n)=>{console.log("Speaking..."),e({text:t.ttsAgenda})})),ttsCancel:Object(c.a)(((t,e)=>{console.log("TTS STOP..."),n()}))}}),u=Object(r.a)(i,3),l=u[0],d=u[1];u[2];return Object(O.jsx)("div",{className:"App",children:Object(O.jsx)(P,{state:l,onClick:()=>d("CLICK")})})}const N=t=>fetch(new Request("https://cors-anywhere.herokuapp.com/https://lab-ii.herokuapp.com/model/parse",{method:"POST",headers:{Origin:"http://localhost:3000/react-xstate-colourchanger"},body:'{"text": "'.concat(t,'"}')})).then((t=>t.json())),j=document.getElementById("root");a.render(Object(O.jsx)(A,{}),j)},9:function(t,e,n){"use strict";function r(t){this.$root=t,this.VOID=[o([])],this.NULL=[],this.GARBAGE=[],this.$check=function(){for(var t in this)if("$root"!==t&&"$check"!==t)try{m(this[t])}catch(e){h("When checking grammar rule '"+t+"'",e)}}}function s(t){return new c(t)}function a(t){return new u(t)}function o(t){return new l(t)}function i(t,e,n){return new d(t,e,n)}function c(t){this.content=t,this._string="$"+t,this.toString=function(){return this._string}}function u(t){this.content=t,this._string="{"+t+"}",this.toString=function(){return this._string}}function l(t){this.content=t,this._string="("+t.join("|")+")",this.toString=function(){return this._string}}function d(t,e,n){this.min=t,this.max=e,this.content=n,this._string=this.content+"<"+this.min+"-"+(this.max==1/0?"":this.max)+">",this.toString=function(){return this._string}}function h(t,e){throw void 0==e?TypeError(t):TypeError(t+"; "+e.message)}function m(t){try{for(var e in t.constructor!==Array&&h("Expected Array, found "+t.constructor.name),t)t[e].constructor==Array?m(t[e]):t[e].constructor!=String&&t[e].checkExpansion()}catch(n){h("When checking sequence expansion",n)}}n.d(e,"a",(function(){return r})),n.d(e,"d",(function(){return s})),n.d(e,"h",(function(){return a})),n.d(e,"b",(function(){return o})),n.d(e,"f",(function(){return i})),n.d(e,"e",(function(){return c})),n.d(e,"i",(function(){return u})),n.d(e,"c",(function(){return l})),n.d(e,"g",(function(){return d})),c.prototype.checkExpansion=function(){this.content.constructor!==String&&h("When checking Ref content; Expected String, found "+this.content.constructor.name)},u.prototype.checkExpansion=function(){this.content.constructor!==String&&h("When checking Tag content; Expected String, found "+this.content.constructor.name)},l.prototype.checkExpansion=function(){try{for(var t in this.content.constructor!==Array&&h("Expected Array, found "+this.content.constructor.name),this.content)m(this.content[t])}catch(e){h("When checking OneOf content",e)}},d.prototype.checkExpansion=function(){try{this.min.constructor===Number&&this.max.constructor===Number||h("Expected min/max to be Number, found "+this.min.constructor.name+"/"+this.max.constructor.name),0<=this.min&&this.min<=this.max||h("Expected 0 <= min <= max, found "+this.min+"/"+this.max),m(this.content)}catch(t){h("When checking Repeat content",t)}}}},[[42,1,2]]]);
//# sourceMappingURL=main.90078f62.chunk.js.map